# Клієнтський Роутінг в Next.JS

Всім привіт, вітаю вас на експрес курсі Next.JS для початківців. Мене звати Віталій Рубан, я працюю в компанії Ітера і сьогодні у нас тема - Клієнтський Роутінг в Next.JS

Я розповім про

- Принципи побудови routing в Next.JS
- Як додавати нові сторінки
- Як додавати layout
- Навіщо потрібні файли loading.tsx та error.tsx

А в якості практичного завдання ми додамо сторінку про автора та сторінку для конкретного відео.

Починаємо

Роутинг в Next.JS суттєво відрізняється від звичного нам роутингу в React-Router-Dom. В react-router-dom ми описуємо наші роути в коді. Наприклад ось так:

Next.JS пішов іншим шляхом - для побудови роутингу Next використовує вашу структуру проекту та конвенції як називати файли та теки для маніпуляцій з роутингом. Цих правил не багато, ви легко їх запам'ятаєте. Для прикладу, всі сторінки в next.js обов'язково називаються page і мусять мати дефолтний експорт. Файли які не називаються page - ігноруються під час побудови роутингу

## Як додавати нові сторінки

Додати нову сторінку в Next.JS дуже просто. Для цього потрібно виконати декілька дій:

- Створити теку, яка має називатися так як ви хочете щоб називався ваш роут. Наприклад, якщо я хочу створити створінку яка буде доступна по url `/about` - я створю теку, яка називається `about`
- У створену теку покласти файл page.tsx | page.jsx
- У файлі page створити react компонент і зробити дефолтний експорт.

Це все що потрібно для того, щоб створити нову сторінку. Якщо ви хочете мати більш складний шлях, наприклад `/course/about` ви спочатку створюєте теку course, потім теку about, а в теці about створюєте файл page.

Як бачите - все досить просто.

А що робити коли наш роутинг динамічний? До прикладу мені потрібно відобразити `lesson/id` де айді динамічний і визначає яку саме лекцію я хочу подивитися. Цей підхід дуже популярний, впевнений ви неодноразово зустрічали його  в електронних магазинах.

Для цього в next.js також є конвенція. Для того щоб працювати з динамічними роутами потрібно просто взяти назву теки у квадратні дужки - [id]. Зауважте, що у квадратні дужки береться не весь шлях, але лише його динамічна частина.

При цьому значення id буде передано в компонент вашої сторінки. Ми на це подивимося на практиці.

## Як додати layout

Окрім сторінок Next.JS дозволяє створювати layout-и - компонент який буде показаний для всіх сторінок та підсторінок. Наприклад, якщо ми не хочемо на кожній сторінці дублювати навігацію та футер, ми можемо винести її в рутовий layout і всі сторінки будуть автоматично "обгорнуті" цим компонентом.

Для того щоб створити layout.tsx потрібно зробити усього три простих кроки

- Додати файл layout.tsx, поруч зі сторінкою, яку ви бажаєте огорнути
- У файлі layout.tsx cтворити компонент, який приймає в якості props children та відмалювати переданий children
- Зробити дефолтний експорт створеного компоненту

І це все. До речі, в Next.JS ви можете мати також і вкладені layout-и.

Окрім layout-ів, Next.JS має ще один досить схожий на них компонент, який називається template. Відмінність між template та layout полягає в тому, що layout, під час зміни сторінки, не перерендерюється і зберігає стейт. А template ні.

Окрім page.tsx та layout.tsx існує ще декілька корисних можливостей які дає нам routing в `next.js`

По-перше це індикація завантаження сторінки або підсторінки. Більше не потрібно оброблювати стан завантаження руками. Достатньо створити layout.tsx та додати поруч із ним файл loading.tsx з дефолтним експортом. Поки ваша сторінка буде вантажитися, компонент з файлу loading.tsx буде показаний автоматично.

По-друге це індикація помилки, яку також не потрібно оброблювати руками. Додаємо layout.tsx, файл error.tsx з дефолтним експортом, і якщо, під час геренації сторінки виникне якась помилка, next.js автоматично покаже компонент з error.tsx. При чому, цей компонент буде показаний саме замість тієї сторінки яка, так би мовити, зламалася. А от вся інша частина застосунку буде працювати так не наче нічого й не сталося.

Ледве не забув - не всі теки приймають участь у створенні роутингу. Якщо ви огорнете теку в круглі дужки - вона також буде виключена з маршрутизації. Це може бути корисним для групування інших тек.

А тепер прийшов час подивитися на це все на практиці.


Роутінг в Next відрізняються від звичного нам React Router Dom. Головна відмінність полягає в тому, що Next будує роутинг автоматично використовуючи за основу структуру вашого проекту. Так, якщо у вас є тека about в якій лежить файл `page.jsx` або `page.tsx`, NextJS автоматично створить роут about в якому буде відображений зміст page.tsx

При цьому є два важливих правила. Перше правило: Вхідна точка для роутінга це файл який обов'язково називається `page.js/jsx/ts/tsx`. Файли які називаються по іншому є звичайними компонентами і не приймають участі у створенні роутінгу.
Друге правило полягає в тому, що кожен Page.jsx має мати дефолтний експорт. Як бачите, базовий роутінг дійсно не складний.

Окрім статичний роутів (тобто таких які відомі наперед) Next.JS підтримує динамічні роути. Типовий приклад динамічного роуту book/123, де 123 це параметер який може приймати будь-яке значення - ми таке вже бачили в React-Router-Dom. Все що потрібно для динамічного роутінгу - це використати квадратні дужки в назві теки. Мій приклад з книгою за номером 123, на Next.JS буде виглядати так:
`/book/[id]/page.tsx`. Синтаксис може не очевидний, але простий.

Починаючи з версії 13.4 Next.JS також підтримує Layout. Все що потрібно щоб додати layout до сторінки - створити файл layout.tsx p з дефолтним експортом. Next.JS передасть туди children, який ви зможете відобразити так як треба.

Також доступні вкладені роути та вкладені layout

Давайте подивимось на це на практиці

Наприклад ./book/:id де id - це змінна
